//==================================================================================================
// hue.rules - Lights and switches rules.
//--------------------------------------------------------------------------------------------------
//	20200114 v15	Ignore Items restored from NULL and unknown Scenes.
//	20191224 v14	Updated Dimmer Switch handling.
//	20191215 v13	Added Bedroom Dimmer scene selections.
//	20191210 v12	Removed superfluous 'sendCommand(ON)' to start lighting scene.
//	20191019 v11	Generalized Scene settings for light groups.
//--------------------------------------------------------------------------------------------------
// Rules in this file:
//	HueDayNight - ...
//..................................................................................................
// Items changed by these rules:
//	Light_Scene_*
//
//==================================================================================================


import org.eclipse.smarthome.model.script.ScriptServiceUtil


//==================================================================================================
// Switch lights on at sunset and off at sunrise (depending on cloudiness).
//==================================================================================================
rule "HueDayNight - Lighting change around sunset/sunrise"
when
	Item Day_Mode changed
then
	val String TAG = "HUE."+triggeringItem.name+".Change"
	var String command = ""

	// Check if we are triggered by persistence restore
	logInfo(TAG, "{} changed to {} from {}", triggeringItem.name, triggeringItem.state, previousState.toString)
	if (previousState == NULL)
		return;

	if (Day_Mode.state == "DAY")
		command = "OFF"
	else if (Day_Mode.state == "EVENING")
		command = "EVENING"
	
	if (command != "") {
		logInfo(TAG, "Send command {} to Light Scenes", command)
		// gLight_Automatic.sendCommand(command)
		Light_Scene_Livingroom.sendCommand(command)
		Light_Scene_Dining.sendCommand(command)
		Light_Scene_Kitchen.sendCommand(command)
		Light_Scene_Hall.sendCommand(command)
		Light_Scene_Outside.sendCommand(command)
		// Light_Scene_Lodge.sendCommand(command)
		val String msg = "Day mode change: lights switched to Scene "+command
		sendBroadcastNotification(msg)
	}
end


//==================================================================================================
// Change lighting in area to the specified scene
//==================================================================================================
rule "Hue scene changing rule"
when
	Item Light_Scene_Livingroom changed or
	Item Light_Scene_Kitchen changed or
	Item Light_Scene_Dining changed or
	Item Light_Scene_Hall changed or
	Item Light_Scene_HallCeiling changed or
	Item Light_Scene_Bathroom changed or
	Item Light_Scene_Bedroom changed or
	Item Light_Scene_Lodge changed or
	Item Light_Scene_Outside changed
then
	val String TAG = "HUE." + triggeringItem.name + ".Change"
	logDebug(TAG, "[{}] changed, state is [{}], previous state [{}]", triggeringItem.name.toString, triggeringItem.state.toString, previousState)
	if (previousState == NULL)
		return;

	val String lightArea = triggeringItem.name.split('_').get(2)
	val String scene = triggeringItem.state.toString
	logDebug(TAG, "Received update [{}] for area [{}]", scene, lightArea)

	val lightGroup = ScriptServiceUtil.getItemRegistry.getItem("gLight_Brightness_" + lightArea)

	logInfo(TAG, "Set Lighting Scene to [{}] for [{}]", scene, lightGroup.name)

	if (scene == "OFF") {
		logDebug(TAG, "Send Command OFF to [{}]", lightGroup)
		lightGroup.sendCommand(OFF)
	}
	else if (scene == "EVENING" || scene == "READ" || scene == "WORK" || scene == "BRIGHT" || scene == "MOVIE") {
		// lightGroup.postUpdate(ON)
		val brightnessGroup = ScriptServiceUtil.getItemRegistry.getItem("gLight_Brightness_" + lightArea)
		val String brightness = ScriptServiceUtil.getItemRegistry.getItem(lightArea + "_Brightness_" + receivedCommand).state.toString
		logDebug(TAG, "Brightness command [{}], group [{}]", brightness, brightnessGroup)
		brightnessGroup.sendCommand(brightness)

		if (lightArea != "Lodge" && lightArea != "Outside") {
			val colorTempGroup = ScriptServiceUtil.getItemRegistry.getItem("gLight_ColorTemp_" + lightArea)
			val String colorTemp = ScriptServiceUtil.getItemRegistry.getItem(lightArea + "_ColorTemp_" + receivedCommand).state.toString
			logDebug(TAG, "ColorTemp command [{}], group [{}]", colorTemp, colorTempGroup)
			colorTempGroup.sendCommand(colorTemp)
		}
	}
	else {
		logWarn(TAG, "Unknown Scene command [{}] received, restore previous state [{}]", scene, previousState)
		Light_Scene_Dining.postUpdate(previousState)
	}
end


//==================================================================================================
//	Signal alert to Kitchen lighting.
//==================================================================================================
rule "Hue Alert Kitchen"
when
	Item Light_Alert_Kitchen changed
then
	val String TAG = "HUE."+triggeringItem+".Change"

	if (triggeringItem.previousState() == NULL)
	{
		logInfo(TAG, "Ignore alert, previous state was NULL")
		return;
	}
	if (triggeringItem.state == ON)
	{
		logInfo(TAG, "Start Alert for Kitchen lighting")
		Light_Alert_KitchenLeft.sendCommand("LSELECT")
		Light_Alert_KitchenRight.sendCommand("LSELECT")
	}
	else
	{
		logInfo(TAG, "Stop Alert for Kitchen lighting")
		Light_Alert_KitchenLeft.sendCommand("NONE")
		Light_Alert_KitchenRight.sendCommand("NONE")
	}
end


//==================================================================================================
//	Hallway motion detection rule.
//==================================================================================================
rule "Hue Motion detected in rule"
when
	Item MS_HallMotion changed
then
	val String TAG = "HUE."+triggeringItem+".Event"

	if (previousState == NULL)
	{
		logInfo(TAG, "Previous state of {} is NULL, ignoring state change", triggeringItem.name)
		return;
	}

	if (triggeringItem.state == ON)
	{
		logInfo(TAG, "Motion Sensor state changed to ON")
	}
	else if (triggeringItem.state == OFF)
	{
		logInfo(TAG, "Motion Sensor state changed to OFF")
	}
	else
	{
		logWarn(TAG, "Invalid state of switch item '{}", triggeringItem)
	}
end


//==================================================================================================
// Handle tap switch commands (for Dining).
//==================================================================================================
rule "Hue Tap Dining room"
when
	Channel "hue:0830:0017882ec5b3:tap_dining:tap_switch_event" triggered
then
    val String TAG = "HUE.DiningTap.Event"
	logInfo(TAG, "HUE Tap Remote switch event {}", receivedEvent)

	switch (receivedEvent.getEvent())
	{
		//--- Upper right button press?
		case "34.0":
		{
			if (Light_Scene_Dining.state == "OFF" || Light_Scene_Dining.state == "BRIGHT")
				Light_Scene_Dining.sendCommand("EVENING")
			else if (Light_Scene_Dining.state == "EVENING")
				Light_Scene_Dining.sendCommand("READ")
			else
				Light_Scene_Dining.sendCommand("BRIGHT")
		}
		//--- Lower right button press?		
		case "18.0":
		{
			Light_Scene_Dining.sendCommand("OFF")
		}
		case "99.0":
		{
			Light_Scene_Dining.sendCommand("OFF")
		}
		//--- Upper left button press?
		case "16.0":
		{
			if (Light_Scene_Livingroom.state == "OFF" || Light_Scene_Livingroom.state == "READ")
				Light_Scene_Livingroom.sendCommand("EVENING")
			else if (Light_Scene_Livingroom.state == "EVENING")
				Light_Scene_Livingroom.sendCommand("MOVIE")
			else
				Light_Scene_Livingroom.sendCommand("READ")
		}
		//--- Lower left button press?
		case "17.0":
		{
			Light_Scene_Livingroom.sendCommand("OFF")
		}
		//--- Lower Left+Right buttons press?	
		case "98.0":
		{
			Light_Scene_Livingroom.sendCommand("OFF")
			Light_Scene_Dining.sendCommand("OFF")
		}
		// Upper Left+Right buttons press?
		case "101.0":
		{
			Light_Scene_Dining.sendCommand("READ")
			Light_Scene_Livingroom.sendCommand("READ")
		}
	}
end


//==================================================================================================
// Hue Tap Switch Kitchen handling rule.
//==================================================================================================
rule "Hue Tap Kitchen rule"
when
	Channel "hue:0830:0017882ec5b3:tap_kitchen:tap_switch_event" triggered
then
    val TAG = "HUE.KitchenTap.Event"
	logInfo(TAG, "HUE Tap Remote switch event {}", receivedEvent)

	switch(receivedEvent.getEvent())
	{
		//--- Upper left button press?
		case "16.0":
		{
			if (Light_Scene_Kitchen.state == "OFF" || Light_Scene_Kitchen.state == "BRIGHT")
				Light_Scene_Kitchen.sendCommand("EVENING")
			else if (Light_Scene_Kitchen.state == "EVENING")
				Light_Scene_Kitchen.sendCommand("WORK")
			else
				Light_Scene_Kitchen.sendCommand("BRIGHT")
		}
		//--- Lower left button press?
		case "17.0": 
		{
			Light_Scene_Kitchen.sendCommand("OFF")
		}	
		//--- Upper right button press?
		case "34.0":
		{
			// if (Light_Scene_KitchenCeiling.state == "OFF" || Light_Scene_KitchenCeiling.state == "BRIGHT"
			// {
			// 	Light_Scene_KitchenCeiling.sendCommand("EVENING")
			// }
			// else if (Light_Scene_KitchenCeiling.state == "EVENING")
			// {
			// 	Light_Scene_KitchenCeiling.sendCommand("WORK")
			// }
			// else
			// {
			// 	Light_Scene_KitchenCeiling.sendCommand("BRIGHT")
			// }
		}
		//--- Lower right button press?
		case "18.0":
		{
			// Light_Scene_KitchenCeiling.sendCommand("OFF")
		}
		//--- Lower Left+Right buttons press?
		case "98.0":
		{
			Light_Scene_Kitchen.sendCommand("OFF")
			// Light_Scene_KitchenCeiling.sendCommand("OFF")
		}
		//--- Upper Left+Right buttons press?
		case "101.0":
		{
			// Upper Right + Left buttons pressed
			Light_Scene_Kitchen.sendCommand("WORK")
			// Light_Scene_KitchenCeiling.sendCommand("WORK")
		}
	}
end


//==================================================================================================
// Dimmer Switch Hall Buttons handling rule.
//--------------------------------------------------------------------------------------------------
// Key 1 (ON) first press:
//		Turn on Hall (wall) lighting and Kitchen lighting (Scene EVENING)
// Key 1 (ON) second press:
//		Turn on Hall Ceiling lighting (Scene EVENING)
// Key 1 (ON) third press:
//		Turn on Hall Ceiling lighting to Scene READ and Hall to Scene READ
// Key 1 (ON) fourth press:
//		Turn off Hall Ceiling lighting, and Hall to Scene EVENING
// Key 1 (ON) Hold:
//		Turn on Hall, Kitchen, Dining, Livingroom lighting to Scene EVENING
//==================================================================================================
rule "Hue Dimmer Switch Hall - Key handle rule"
when
	Channel "hue:0820:0017882ec5b3:dim_hall:dimmer_switch_event" triggered
then
    val String TAG = "HUE.HallDimmer.Event"

	logInfo(TAG, "Event '{}' received", receivedEvent)

	switch(receivedEvent.getEvent())
	{
		//--- Key 1 (ON) Initial Press = Not always triggered, ignoring it.
		case "1000.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Initial Press event triggered [1000] - ignored")
		}

		//--- Key 1 (ON) Hold
		case "1001.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Hold event triggered [1001] - Switch (more) lights on")

			if (Light_Scene_Hall.state == "OFF")
				Light_Scene_Hall.sendCommand("EVENING")
			else if (Light_Scene_Kitchen.state == "OFF")
				Light_Scene_Kitchen.sendCommand("EVENING")
			else if (Light_Scene_Dining.state == "OFF")
				Light_Scene_Dining.sendCommand("EVENING")
			else if (Light_Scene_Livingroom.state == "OFF")
				Light_Scene_Livingroom.sendCommand("EVENING")
		}

		//--- Key 1 (ON) Short Release
		case "1002.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Short Release event triggered [1002]")
	
			if (Light_Scene_Hall.state == "OFF" && Light_Scene_Kitchen.state == "OFF")
			{
				logInfo(TAG, "First Button 1 (ON) Short Release - Set Hall and Kitchen Scene to EVENING")
				Light_Scene_Hall.sendCommand("EVENING")
				Light_Scene_Kitchen.sendCommand("EVENING")
			}
			else if (Light_Scene_Hall.state == "EVENING" && Light_Scene_HallCeiling.state == "OFF")
			{
				logInfo(TAG, "Second Button 1 (ON) Short Release - Set Hall Ceiling Scene to EVENING as well")
				Light_Scene_HallCeiling.sendCommand("EVENING")
			}
			else if (Light_Scene_Hall.state == "EVENING" && Light_Scene_HallCeiling.state == "EVENING")
			{
				logInfo(TAG, "Third Button 1 (ON) Short Release - Set Hall (Ceiling) Scene to READ")
				Light_Scene_HallCeiling.sendCommand("READ")
				Light_Scene_Hall.sendCommand("READ")
			}
			else if (Light_Scene_HallCeiling.state == "READ" && Light_Scene_Hall.state == "READ")
			{
				logInfo(TAG, "Fourth Button 1 (ON) Short Release - Set Hall (Ceiling) Scene back")
				Light_Scene_HallCeiling.sendCommand("OFF")
				Light_Scene_Hall.sendCommand("EVENING")
			}
			else
			{
				logInfo(TAG, "Unknown Button 1 (ON) Short Release state - reset to all EVENING scene")
				Light_Scene_HallCeiling.sendCommand("EVENING")
				Light_Scene_Hall.sendCommand("EVENING")
			}
		}

		//--- Key 1 (ON) Long Release
		case "1003.0":
		{
		    logInfo(TAG,"Dimmer Button 1 (ON) Long Release event triggered [1003] - ignored")
		}

		//--- Key 2 (INCREASE) Initial Press
		case "2000.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Initial Press [2000] - ignored")
		}

		//--- Key 2 (INCREASE) Hold
		case "2001.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Hold [2001] - increade brightness Lighting")
			if (Light_Scene_Hall.state != "OFF")
				gLight_Brightness_Hall.sendCommand(INCREASE)
			if (Light_Scene_HallCeiling.state != "OFF")
				gLight_Brightness_HallCeiling.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Short Release
		case "2002.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Short Release [2002]")
			if (Light_Scene_Hall.state != "OFF")
			{
				logInfo(TAG, "Increase Hall Wall Lighting brightness")
				gLight_Brightness_Hall.sendCommand(INCREASE)
			}
			if (Light_Scene_HallCeiling.state != "OFF")
			{
				logInfo(TAG, "Increase Hall Ceiling Lighting brightness")
				gLight_Brightness_HallCeiling.sendCommand(DECREASE)
			}
		}

		//--- Key 2 (INCREASE) Long Release
		case "2003.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Long Release [2003] - ignored")
		}

		//--- Key 3 (DECREASE) Initial Press
		case "3000.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Initial Press [3000] - ignored")
		}

		//--- Key 3 (DECREASE) Hold
		case "3001.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Hold [3001] - Decrease brightness Lighting")
			if (Light_Scene_Hall.state != "OFF")
				gLight_Brightness_Hall.sendCommand(DECREASE)
			if (Light_Scene_HallCeiling.state != "OFF")
				gLight_Brightness_HallCeiling.sendCommand(DECREASE)

		}

		//--- Key 3 (DECREASE) Short Release
		case "3002.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Short Release [3002]")
			if (Light_Scene_Hall.state != "OFF")
			{
				logInfo(TAG, "Decrease Hall Wall Lighting brightness")
				gLight_Brightness_Hall.sendCommand(DECREASE)
			}
			if (Light_Scene_HallCeiling.state != "OFF")
			{
				logInfo(TAG, "Decrease Hall Ceiling Lighting brightness")
				gLight_Brightness_HallCeiling.sendCommand(DECREASE)
			}
		}

		//--- Key 3 (DECREASE) Long Release
		case "3003.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Long Releas3 [3003] - ignored")
		}

		//--- Key 4 (OFF) Initial Press. Ignored, not always triggered.
		case "4000.0":
		{
			logInfo(TAG,"Dimmer Button 4 (OFF) Initial press [4000] - Turn off Lighting")
		}

		//--- Key 4 (OFF) Hold
		case "4001.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Hold [4001]")
			if (Light_Scene_Livingroom.state != "OFF")
				Light_Scene_Livingroom.sendCommand("OFF")
			else if (Light_Scene_Dining.state != "OFF")
				Light_Scene_Dining.sendCommand("OFF")
			else if (Light_Scene_Kitchen.state != "OFF")
				Light_Scene_Kitchen.sendCommand("OFF")
			else
			{
				Light_Scene_HallCeiling.sendCommand("OFF")
				Light_Scene_Hall.sendCommand("OFF")
			}
		}

		//--- Key 4 (OFF) Short Release
		case "4002.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Short Release [4002]")

			if (Light_Scene_HallCeiling.state != "OFF")
				Light_Scene_HallCeiling.sendCommand("OFF")

			if (Light_Scene_Hall.state == "READ")
			{
				Light_Scene_Hall.sendCommand("EVENING")
			}
			else if (Light_Scene_Hall.state == "EVENING")
			{
				Light_Scene_Hall.sendCommand("OFF")
				Light_Scene_Kitchen.sendCommand("OFF")
			}
		}

		//--- Key 4 (OFF) Long Release
		case "4003.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Long Release [4003]")
			Light_Scene_Livingroom.sendCommand("OFF")
			Light_Scene_Dining.sendCommand("OFF")
			Light_Scene_Kitchen.sendCommand("OFF")
			// Light_Scene_KitchenCeiling.sendCommand("OFF")
			Light_Scene_HallCeiling.sendCommand("OFF")
			Light_Scene_Hall.sendCommand("OFF")
		}
	}
end


//==================================================================================================
// Dimmer Switch Bedroom Left handling rule.
//--------------------------------------------------------------------------------------------------
// Key 1 (ON) first press:
//		Turn on Bedroom lighting (Scene EVENING)
// Key 1 (ON) second press:
//		Turn on Bedroom lighting (Scene READ)
// Key 1 (ON) third press:
//		Turn on Bedroom lighting (Scene COSY)
// Key 1 (ON) Hold:
//		Turn on left Bedroom light (rotate through EVENING and READ Scene)
// Key 4 (OFF) Hold:
//		Turn of Livingroom, Dining, Bedroom light and turn on alarm (ARMED_HOME)
//==================================================================================================
rule "Hue.BedLDim.Event - Dimmer Switch Bedroom Left rule"
when
	Channel "hue:0820:0017882ec5b3:dim_lbed:dimmer_switch_event" triggered
then
    val String TAG = "HUE.BedLDim.Event"

	logInfo(TAG, "Event '{}' received", receivedEvent)

	switch(receivedEvent.getEvent())
	{
		//--- Key 1 (ON) Initial Press = Not always triggered, ignoring it.
		case "1000.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Initial Press event triggered [1000] - ignored")
		}

		//--- Key 1 (ON) Hold
		case "1001.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Hold event triggered [1001] - Switch left bed light on")

			if (Light_Dim_BedroomLeft.state == OFF || Light_Dim_BedroomLeft.state as Number == Bedroom_Brightness_READ.state as Number)
			{
				logInfo(TAG, "Turn on left bedroom light to EVENING scene")
				Light_Dim_BedroomLeft.sendCommand(Bedroom_Brightness_EVENING.state as Number)
				Light_ColorTemp_BedroomLeft.sendCommand(Bedroom_ColorTemp_EVENING.state as Number)
			}
			else if (Light_Dim_BedroomLeft.state as Number == Bedroom_Brightness_EVENING.state as Number)
			{
				logInfo(TAG, "Turn on left bedroom light to READ scene")
				Light_Dim_BedroomLeft.sendCommand(Bedroom_Brightness_READ.state as Number)
				Light_ColorTemp_BedroomLeft.sendCommand(Bedroom_ColorTemp_READ.state as Number)
			}
			else
			{
				logInfo(TAG, "Turn on left bedroom light back to EVENING scene")
				Light_Dim_BedroomLeft.sendCommand(Bedroom_Brightness_EVENING.state as Number)
				Light_ColorTemp_BedroomLeft.sendCommand(Bedroom_ColorTemp_EVENING.state as Number)
			}
		}

		//--- Key 1 (ON) Short Release
		case "1002.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Short Release event triggered [1002]")
	
			if (Light_Scene_Bedroom.state == "OFF")
				Light_Scene_Bedroom.sendCommand("EVENING")
			else if (Light_Scene_Bedroom.state == "EVENING")
				Light_Scene_Bedroom.sendCommand("READ")
			else if (Light_Scene_Bedroom.state == "READ")
				Light_Scene_Bedroom.sendCommand("COSY")
			else
				Light_Scene_Bedroom.sendCommand("EVENING")
		}

		//--- Key 1 (ON) Long Release
		case "1003.0":
		{
		    logInfo(TAG,"Dimmer Button 1 (ON) Long Release event triggered [1003] - ignored")
		}

		//--- Key 2 (INCREASE) Initial Press
		case "2000.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Initial Press [2000] - ignored")
		}

		//--- Key 2 (INCREASE) Hold
		case "2001.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Hold [2001] - increade brightness Lighting")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(INCREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Short Release
		case "2002.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Short Release [2002]")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(INCREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Long Release
		case "2003.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Long Release [2003] - ignored")
		}

		//--- Key 3 (DECREASE) Initial Press
		case "3000.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Initial Press [3000] - ignored")
		}

		//--- Key 3 (DECREASE) Hold
		case "3001.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Hold [3001] - Decrease brightness Lighting")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(DECREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(DECREASE)
		}

		//--- Key 3 (DECREASE) Short Release
		case "3002.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Short Release [3002]")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(INCREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(INCREASE)
		}

		//--- Key 3 (DECREASE) Long Release
		case "3003.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Long Releas3 [3003] - ignored")
		}

		//--- Key 4 (OFF) Initial Press. Ignored, not always triggered.
		case "4000.0":
		{
			logInfo(TAG,"Dimmer Button 4 (OFF) Initial press [4000] - Turn off Lighting")
		}

		//--- Key 4 (OFF) Hold
		case "4001.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Hold [4001]")
			Light_Scene_Bedroom.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Short Release
		case "4002.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Short Release [4002]")

			if (Light_Scene_Bedroom.state != "OFF")
				Light_Scene_Bedroom.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Long Release
		case "4003.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Long Release [4003] - Turn off lights, turn on alarm")
			Light_Scene_Bedroom.sendCommand("OFF")
			Light_Scene_Livingroom.sendCommand("OFF")
			Light_Scene_Dining.sendCommand("OFF")
			// Alarm_Status.sendCommand("ARMED_HOME")
		}
	}
end


//==================================================================================================
// Dimmer Switch Bedroom Right handling rule.
//--------------------------------------------------------------------------------------------------
// Key 1 (ON) first press:
//		Turn on Bedroom lighting (Scene EVENING)
// Key 1 (ON) second press:
//		Turn on Bedroom lighting (Scene READ)
// Key 1 (ON) third press:
//		Turn on Bedroom lighting (Scene COSY)
// Key 1 (ON) Hold:
//		Turn on right Bedroom light (rotate through EVENING and READ Scene)
//
//==================================================================================================
rule "Hue.BedRDim.Event - Dimmer Switch Bedroom Right rule"
when
	Channel "hue:0820:0017882ec5b3:dim_rbed:dimmer_switch_event" triggered
then
    val String TAG = "HUE.BedRDim.Event"

	logInfo(TAG, "Event '{}' received", receivedEvent)

	switch(receivedEvent.getEvent())
	{
		//--- Key 1 (ON) Initial Press = Not always triggered, ignoring it.
		case "1000.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Initial Press event triggered [1000] - ignored")
		}

		//--- Key 1 (ON) Hold
		case "1001.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Hold event triggered [1001] - Switch right bed light on")

			if (Light_Dim_BedroomRight.state == OFF || Light_Dim_BedroomRight.state as Number == Bedroom_Brightness_READ.state as Number)
			{
				logInfo(TAG, "Turn on Right Bedroom light to EVENING Scene")
				Light_Dim_BedroomRight.sendCommand(Bedroom_Brightness_EVENING.state as Number)
				Light_ColorTemp_BedroomRight.sendCommand(Bedroom_ColorTemp_EVENING.state as Number)
			}
			else if (Light_Dim_BedroomRight.state as Number == Bedroom_Brightness_EVENING.state as Number)
			{
				logInfo(TAG, "Turn on Right Bedroom light to READ Scene")
				Light_Dim_BedroomRight.sendCommand(Bedroom_Brightness_READ.state as Number)
				Light_ColorTemp_BedroomRight.sendCommand(Bedroom_ColorTemp_READ.state as Number)
			}
			else
			{
				logInfo(TAG, "Turn on Right Bedroom light back to EVENING Scene")
				Light_Dim_BedroomRight.sendCommand(Bedroom_Brightness_EVENING.state as Number)
				Light_ColorTemp_BedroomRight.sendCommand(Bedroom_ColorTemp_EVENING.state as Number)
			}
		}

		//--- Key 1 (ON) Short Release
		case "1002.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Short Release event triggered [1002]")
	
			if (Light_Scene_Bedroom.state == "OFF")
				Light_Scene_Bedroom.sendCommand("EVENING")
			else if (Light_Scene_Bedroom.state == "EVENING")
				Light_Scene_Bedroom.sendCommand("READ")
			else if (Light_Scene_Bedroom.state == "READ")
				Light_Scene_Bedroom.sendCommand("COSY")
			else
				Light_Scene_Bedroom.sendCommand("EVENING")
		}

		//--- Key 1 (ON) Long Release
		case "1003.0":
		{
		    logInfo(TAG,"Dimmer Button 1 (ON) Long Release event triggered [1003] - ignored")
		}

		//--- Key 2 (INCREASE) Initial Press
		case "2000.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Initial Press [2000] - ignored")
		}

		//--- Key 2 (INCREASE) Hold
		case "2001.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Hold [2001] - increade brightness Lighting")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(INCREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Short Release
		case "2002.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Short Release [2002]")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(INCREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Long Release
		case "2003.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Long Release [2003] - ignored")
		}

		//--- Key 3 (DECREASE) Initial Press
		case "3000.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Initial Press [3000] - ignored")
		}

		//--- Key 3 (DECREASE) Hold
		case "3001.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Hold [3001] - Decrease brightness Lighting")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(DECREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(DECREASE)
		}

		//--- Key 3 (DECREASE) Short Release
		case "3002.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Short Release [3002]")
			if (Light_Dim_BedroomLeft.state != OFF)
				Light_Dim_BedroomLeft.sendCommand(INCREASE)
			if (Light_Dim_BedroomRight.state != OFF)
				Light_Dim_BedroomRight.sendCommand(INCREASE)
		}

		//--- Key 3 (DECREASE) Long Release
		case "3003.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Long Releas3 [3003] - ignored")
		}

		//--- Key 4 (OFF) Initial Press. Ignored, not always triggered.
		case "4000.0":
		{
			logInfo(TAG,"Dimmer Button 4 (OFF) Initial press [4000] - Turn off Lighting")
		}

		//--- Key 4 (OFF) Hold
		case "4001.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Hold [4001]")
			Light_Scene_Bedroom.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Short Release
		case "4002.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Short Release [4002]")

			if (Light_Scene_Bedroom.state != "OFF")
				Light_Scene_Bedroom.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Long Release
		case "4003.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Long Release [4003] - Turn off lights, turn on alarm")
			Light_Scene_Bedroom.sendCommand("OFF")
			Light_Scene_Livingroom.sendCommand("OFF")
			Light_Scene_Dining.sendCommand("OFF")
			// Alarm_Status.sendCommand("ARMED_HOME")
		}
	}
end


//==================================================================================================
// Dimmer Switch Bathroom handling rule.
//--------------------------------------------------------------------------------------------------
// Key 1 (ON) first press:
//		Turn on Bathroom lighting (Scene EVENING)
// Key 1 (ON) second press:
//		Turn on Bathroom lighting (Scene READ)
// Key 1 (ON) third press:
//		Turn on Bathroom lighting (Scene BRIGHT)
// Key 1 (ON) fourth press:
//		TUrn on Bathroom lighting (Scene EVENING)
//
//==================================================================================================
rule "Hue.BathDim.Event - Dimmer Switch Bathroom rule"
when
	Channel "hue:0820:0017882ec5b3:dim_bathroom:dimmer_switch_event" triggered
then
    val String TAG = "HUE.BathDim.Event"

	logInfo(TAG, "Event '{}' received", receivedEvent)

	switch(receivedEvent.getEvent())
	{
		//--- Key 1 (ON) Initial Press = Not always triggered, ignoring it.
		case "1000.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Initial Press event triggered [1000] - ignored")
		}

		//--- Key 1 (ON) Hold
		case "1001.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Hold event triggered [1001] - ignored")
		}

		//--- Key 1 (ON) Short Release
		case "1002.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Short Release event triggered [1002], state is {}", Light_Scene_Bathroom.state)
	
			if (Light_Scene_Bathroom.state == "OFF")
				Light_Scene_Bathroom.sendCommand("EVENING")
			else if (Light_Scene_Bathroom.state == "EVENING")
				Light_Scene_Bathroom.sendCommand("READ")
			else if (Light_Scene_Bathroom.state == "READ")
				Light_Scene_Bathroom.sendCommand("BRIGHT")
			else
				Light_Scene_Bathroom.sendCommand("EVENING")
		}

		//--- Key 1 (ON) Long Release
		case "1003.0":
		{
		    logInfo(TAG,"Dimmer Button 1 (ON) Long Release event triggered [1003] - ignored")
		}

		//--- Key 2 (INCREASE) Initial Press
		case "2000.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Initial Press [2000] - ignored")
		}

		//--- Key 2 (INCREASE) Hold
		case "2001.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Hold [2001] - increade brightness Lighting")
			if (gLight_Brightness_Bathroom.state != OFF)
				gLight_Brightness_Bathroom.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Short Release
		case "2002.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Short Release [2002]")
			if (gLight_Brightness_Bathroom.state != OFF)
				gLight_Brightness_Bathroom.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Long Release
		case "2003.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Long Release [2003] - ignored")
		}

		//--- Key 3 (DECREASE) Initial Press
		case "3000.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Initial Press [3000] - ignored")
		}

		//--- Key 3 (DECREASE) Hold
		case "3001.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Hold [3001] - Decrease brightness Lighting")
			if (gLight_Brightness_Bathroom.state != OFF)
				gLight_Brightness_Bathroom.sendCommand(DECREASE)
		}

		//--- Key 3 (DECREASE) Short Release
		case "3002.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Short Release [3002]")
			if (gLight_Brightness_Bathroom.state != OFF)
				gLight_Brightness_Bathroom.sendCommand(DECREASE)
		}

		//--- Key 3 (DECREASE) Long Release
		case "3003.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Long Releas3 [3003] - ignored")
		}

		//--- Key 4 (OFF) Initial Press. Ignored, not always triggered.
		case "4000.0":
		{
			logInfo(TAG,"Dimmer Button 4 (OFF) Initial press [4000] - Turn off Lighting")
		}

		//--- Key 4 (OFF) Hold
		case "4001.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Hold [4001]")
			Light_Scene_Bathroom.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Short Release
		case "4002.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Short Release [4002]")

			if (Light_Scene_Bathroom.state != "OFF")
				Light_Scene_Bathroom.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Long Release
		case "4003.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Long Release [4003] - Turn off lighting")
			Light_Scene_Bathroom.sendCommand("OFF")
		}
	}
end


//==================================================================================================
// Dimmer Switch Laundry room handling rule.
//--------------------------------------------------------------------------------------------------
// Key 1 (ON) first press:
//		Turn on lighting (Scene EVENING)
// Key 1 (ON) second press:
//		Turn on lighting (Scene READ)
// Key 1 (ON) third press:
//		Turn on lighting (Scene BRIGHT)
// Key 1 (ON) fourth press:
//		TUrn on lighting (Scene EVENING)
//
//==================================================================================================
rule "Hue.LaundryDim.Event - Dimmer Switch Laundry room rule"
when
	Channel "hue:0820:0017882ec5b3:dim_laundry:dimmer_switch_event" triggered
then
    val String TAG = "HUE.LaundryDim.Event"

	logInfo(TAG, "Event '{}' received", receivedEvent)

	switch(receivedEvent.getEvent())
	{
		//--- Key 1 (ON) Initial Press = Not always triggered, ignoring it.
		case "1000.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Initial Press event triggered [1000] - ignored")
		}

		//--- Key 1 (ON) Hold
		case "1001.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Hold event triggered [1001] - ignored")
		}

		//--- Key 1 (ON) Short Release
		case "1002.0":
		{
		    logInfo(TAG,"Dimmer Switch Button 1 (ON) Short Release event triggered [1002]")
	
			if (Light_Scene_Laundry.state == "OFF")
				Light_Scene_Laundry.sendCommand("EVENING")
			else if (Light_Scene_Laundry.state == "EVENING")
				Light_Scene_Laundry.sendCommand("READ")
			else if (Light_Scene_Laundry.state == "READ")
				Light_Scene_Laundry.sendCommand("BRIGHT")
			else
				Light_Scene_Laundry.sendCommand("EVENING")
		}

		//--- Key 1 (ON) Long Release
		case "1003.0":
		{
		    logInfo(TAG,"Dimmer Button 1 (ON) Long Release event triggered [1003] - ignored")
		}

		//--- Key 2 (INCREASE) Initial Press
		case "2000.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Initial Press [2000] - ignored")
		}

		//--- Key 2 (INCREASE) Hold
		case "2001.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Hold [2001] - increade brightness Laundry Lighting")
			if (gLight_Brightness_Laundry.state != OFF)
				gLight_Brightness_Laundry.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Short Release
		case "2002.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Short Release [2002]")
			if (gLight_Brightness_Laundry.state != OFF)
				gLight_Brightness_Laundry.sendCommand(INCREASE)
		}

		//--- Key 2 (INCREASE) Long Release
		case "2003.0":
		{
		    logInfo(TAG,"Dimmer Button 2 (INCREASE) Long Release [2003] - ignored")
		}

		//--- Key 3 (DECREASE) Initial Press
		case "3000.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Initial Press [3000] - ignored")
		}

		//--- Key 3 (DECREASE) Hold
		case "3001.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Hold [3001] - Decrease brightness Bedroom Lighting")
			if (gLight_Brightness_Laundry.state != OFF)
				gLight_Brightness_Laundry.sendCommand(DECREASE)
		}

		//--- Key 3 (DECREASE) Short Release
		case "3002.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Short Release [3002]")
			if (gLight_Brightness_Laundry.state != OFF)
				gLight_Brightness_Laundry.sendCommand(DECREASE)
		}

		//--- Key 3 (DECREASE) Long Release
		case "3003.0":
		{
		    logInfo(TAG,"Dimmer Button 3 (DECREASE) Long Releas3 [3003] - ignored")
		}

		//--- Key 4 (OFF) Initial Press. Ignored, not always triggered.
		case "4000.0":
		{
			logInfo(TAG,"Dimmer Button 4 (OFF) Initial press [4000] - Turn off Lighting")
		}

		//--- Key 4 (OFF) Hold
		case "4001.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Hold [4001]")
			Light_Scene_Laundry.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Short Release
		case "4002.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Short Release [4002]")

			if (Light_Scene_Laundry.state != "OFF")
				Light_Scene_Laundry.sendCommand("OFF")
		}

		//--- Key 4 (OFF) Long Release
		case "4003.0":
		{
		    logInfo(TAG,"Dimmer Button 4 (OFF) Long Release [4003] - Turn off light")
			Light_Scene_Laundry.sendCommand("OFF")
		}
	}
end


//==================================================================================================
// Toilet Dimmer Switch
//==================================================================================================
rule "Hue Dimmer Toilet"
when
	Channel "hue:0820:0017882ec5b3:dim_toilet:dimmer_switch_event" triggered
then
    val String tag = "HUErule.DimmerSwitch.Event"

	logInfo(tag, "---> HUE Dimmer switch event {}", receivedEvent)

	switch(receivedEvent.getEvent()) {
		case "1000.0":
		{
		    logInfo(tag,"---> Dimmer Button 1 initial pressed")
			Light_Scene_Toilet.sendCommand("EVENING")
		}		
		case "1001.0":
		{
		    logInfo(tag,"---> Dimmer Button 1 hold")
			//do more stuff
		}
		case "1002.0":
		{
		    logInfo(tag,"---> Dimmer Button 1 short released")
			Light_Scene_Toilet.sendCommand("EVENING")
		}	
		case "1003.0":
		{
		    logInfo(tag,"---> Dimmer Button 1 long released")
			//do any stuff
		}
		case "2000.0":
		{
		    logInfo(tag,"---> Dimmer Button 2 initial pressed")
			//do stuff
		}		
		case "2001.0":
		{
		    logInfo(tag,"---> Dimmer Button 2 hold")
			//do more stuff
		}
		case "2002.0":
		{
		    logInfo(tag,"---> Dimmer Button 2 short released")
			//do other stuff
		}	
		case "2003.0":
		{
		    logInfo(tag,"---> Dimmer Button 2 long released")
			//do any stuff
		}
		case "3000.0":
		{
		    logInfo(tag,"---> Dimmer Button 3 initial pressed")
			//do stuff
		}		
		case "3001.0":
		{
		    logInfo(tag,"---> Dimmer Button 3 hold")
			//do more stuff
		}
		case "3002.0":
		{
		    logInfo(tag,"---> Dimmer Button 3 short released")
			//do other stuff
		}	
		case "3003.0":
		{
		    logInfo(tag,"---> Dimmer Button 3 long released")
			//do any stuff
		}
		case "4000.0":
		{
		    logInfo(tag,"---> Dimmer Button 4 initial pressed")
			Light_Scene_Toilet.sendCommand("OFF")
		}		
		case "4001.0":
		{
		    logInfo(tag,"---> Dimmer Button 4 hold")
			//do more stuff
		}
		case "4002.0":
		{
		    logInfo(tag,"---> Dimmer Button 4 short released")
			Light_Scene_Toilet.sendCommand("OFF")
		}	
		case "4003.0":
		{
		    logInfo(tag,"---> Dimmer Button 4 long released")
			//do any stuff
		}
	}
end


//==================================================================================================
// Toilet temperature sensor
//==================================================================================================
rule "Toilet Temp updated"
when
	Item Motion_Temperature_Toilet received update
then
	logDebug("HUE.MS_Toilet.Changed", "---> Item (Number-UoM) MS_ToiletTemp updated: {}", Motion_Temperature_Toilet)
end


rule "Hue Dimmer Test"
when
	Channel "hue:0820:0017882ec5b3:dim_test:dimmer_switch_event" triggered
then
    val tag = "HUE.DimmerSwitch.Event"

	logInfo(tag, "---> HUE Dimmer switch event {}", receivedEvent)
end
